{% extends "base.html" %}
{% load staticfiles %}
{% load static %}

{% block meta %}
<meta name="google-signin-scope" content="profile email">
<meta name="google-signin-client_id" content="419002796892-0tlg9tf8gr3do7ksjjbp23ckrcqnug35.apps.googleusercontent.com">
<script src="https://apis.google.com/js/platform.js" async defer></script>
{% endblock %}

{% block title %}
HOME
{% endblock %}

{% block css %}

{% endblock %}

{% block content %}
<h2>Test Login</h2>
<div class="row">
  <div class="col-md-4">
    <div class="g-signin2" data-onsuccess="onSignIn_employer" data-theme="dark"></div>
  </div>
  <div class="col-md-4">
    <div class="g-signin2" data-onsuccess="onSignIn_job_seeker" data-theme="dark"></div>
  </div>
</div>
{% endblock %}

{% block javascript %}
<script>
// Post profile_id ke backend
function loadDoc(profile_id, full_name, email, status) {
  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      // document.getElementById("demo").innerHTML = this.responseText;
    }
  };
  xhttp.open("POST", "/public_home/login/", true);
  xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
  xhttp.send("profile_id=" + profile_id + "&full_name=" + full_name + "&email=" + email + "&status=" + status + "");
}
// Untuk sign-in
function onSignIn_employer(googleUser) {
  // Useful data for your client-side scripts:
  var profile = googleUser.getBasicProfile();
  console.log("ID: " + profile.getId()); // Don't send this directly to your server!
  console.log('Full Name: ' + profile.getName());
  console.log('Given Name: ' + profile.getGivenName());
  console.log('Family Name: ' + profile.getFamilyName());
  console.log("Image URL: " + profile.getImageUrl());
  console.log("Email: " + profile.getEmail());
  var profile_id = profile.getId();
  var full_name = profile.getName();
  var email = profile.getEmail();
  // The ID token you need to pass to your backend:
  var id_token = googleUser.getAuthResponse().id_token;
  console.log("ID Token: " + id_token);
  loadDoc(profile_id, full_name, email, "employer");
};
function onSignIn_job_seeker(googleUser) {
  // Useful data for your client-side scripts:
  var profile = googleUser.getBasicProfile();
  console.log("ID: " + profile.getId()); // Don't send this directly to your server!
  var profile_id = profile.getId();

  // The ID token you need to pass to your backend:
  var id_token = googleUser.getAuthResponse().id_token;
  console.log("ID Token: " + id_token);
  loadDoc(profile_id, full_name, email, "job_seeker");
};
</script>
{% endblock %}
